#! /usr/bin/perl -w
#
# Creates the src/T2KBuild.h header file
#
# Authors:
# Costas Andreopoulos <costas.andreopoulos \at stfc.ac.uk>
#  STFC - Rutherford Appleton Laboratory, UK
#
# Jim Dobson <j.dobson07 \at imperial.ac.uk>
#  Imperial College London, UK

$TOPDIR = $ENV{'T2KREWEIGHT'};
die ("The T2KREWEIGHT environmental variable is defined!") unless defined $TOPDIR;

# config file
#
$CONF_FILE = "$TOPDIR/make/Make.config";
die("Can not open $TOPDIR/make/Make.config!") unless (-e $CONF_FILE);

# Open header file
#
$BLD_FILE = "$TOPDIR/src/T2KBuild.h";
open(BLD, ">$BLD_FILE") or die("Can not write out the T2KBuild.h file!");

# Write header file
#
print BLD "#ifndef _T2KRW_BUILD_INFO_H_ \n";
print BLD "#define _T2KRW_BUILD_INFO_H_ \n";
print BLD "/* \n";
print BLD " * Build information automatically generated by the T2KReWeight installer \n";
print BLD "*/ \n\n";

# oaAnalysis enabled?
#
@nret = `grep 'T2KREWEIGHT_OPTION_ENABLE_OAANALYSIS=YES' $CONF_FILE`;
if(@nret>0) 
      { print BLD   "#define __T2KRW_OAANALYSIS_ENABLED__\n"; }
else  { print BLD "//#define __T2KRW_OAANALYSIS_ENABLED__\n"; }

# GENIE enabled?
#
@nret = `grep 'T2KREWEIGHT_OPTION_ENABLE_GENIE=YES' $CONF_FILE`;
if(@nret>0) 
      { print BLD   "#define __T2KRW_GENIE_ENABLED__\n"; }
else  { print BLD "//#define __T2KRW_GENIE_ENABLED__\n"; }

# NEUT enabled? 
@bret = `grep 'T2KREWEIGHT_OPTION_ENABLE_NEUT=YES' $CONF_FILE`;
if(@bret>0) 
      { print BLD   "#define __T2KRW_NEUT_ENABLED__\n"; }
else  { print BLD "//#define __T2KRW_NEUT_ENABLED__\n"; }

# JNUBEAM enabled? 
@nret = `grep 'T2KREWEIGHT_OPTION_ENABLE_JNUBEAM=YES' $CONF_FILE`;
if(@nret>0) 
      { print BLD   "#define __T2KRW_JNUBEAM_ENABLED__\n"; }
else  { print BLD "//#define __T2KRW_JNUBEAM_ENABLED__\n"; }

# NIWG enabled? 
@nret = `grep 'T2KREWEIGHT_OPTION_ENABLE_NIWG=YES' $CONF_FILE`;
if(@nret>0) 
      { print BLD   "#define __T2KRW_NIWG_ENABLED__\n"; }
else  { print BLD "//#define __T2KRW_NIWG_ENABLED__\n"; }

# GEANT enabled? 
@nret = `grep 'T2KREWEIGHT_OPTION_ENABLE_GEANT=YES' $CONF_FILE`;
if(@nret>0) 
      { print BLD   "#define __T2KRW_GEANT_ENABLED__\n"; }
else  { print BLD "//#define __T2KRW_GEANT_ENABLED__\n"; }

# Tracker File enabled? 
@nret = `grep 'T2KREWEIGHT_OPTION_ENABLE_TRACKERFILE=YES' $CONF_FILE`;
if(@nret>0)
      { print BLD   "#define __T2KRW_TRACKERFILE_ENABLED__\n"; }
else  { print BLD "//#define __T2KRW_TRACKERFILE_ENABLED__\n"; }

# psyche enabled?
@nret = `grep 'T2KREWEIGHT_OPTION_ENABLE_PSYCHE=YES' $CONF_FILE`;
if(@nret>0)
      { print BLD   "#define __T2KRW_PSYCHE_ENABLED__\n"; }
else  { print BLD "//#define __T2KRW_PSYCHE_ENABLED__\n"; }




print BLD "\n#endif\n\n";

# Close header file
#
close(BLD);

