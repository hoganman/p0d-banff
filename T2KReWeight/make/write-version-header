#! /usr/bin/perl -w
#
# Creates the src/Conventions/T2KVersion.h header file
#
# C.Andreopoulos <costas.andreopoulos \at stfc.ac.uk>
# Rutherford Lab.
#

$TOPDIR = $ENV{'T2KREWEIGHT'};
die ("The T2KREWEIGHT environmental variable is not defined!") unless defined $TOPDIR;

# Read version info
$REL_INFO_FILE = "$TOPDIR/VERSION";
open(REL_INFO, "<$REL_INFO_FILE") or die("Can not read the T2KREWEIGHT release information!");
@rel_info=<REL_INFO>;
close(REL_INFO);
chomp($release = $rel_info[0]);

# ($major, $minor, $rev) = split('.', $release);
# note: split() doesn't split on dots...
$release=~m/(\d+).(\d+).(\d+)/;
$major = $1;
$minor = $2;
$revis = $3;

# Open header file
$VRS_FILE = "$TOPDIR/src/T2KVersion.h";
open(VRS, ">$VRS_FILE") or die("Can not write out the T2KVersion.h file!");

# Write header file
print VRS "#ifndef _T2KRW_VERSION_H_ \n";
print VRS "#define _T2KRW_VERSION_H_ \n";
print VRS "/* \n";
print VRS " * Version information automatically generated by the T2KReWeight installer \n";
print VRS " * \n";
print VRS " * These macros can be used in the following way (as the ones at ROOT's RVersion.h): \n";
print VRS " * #if __T2KREWEIGHT_RELEASE_CODE__ >= T2KREWEIGHTRELCODE(2,4,11) \n";
print VRS " * #include <newheader.h>\n";
print VRS " * #else\n";
print VRS " * #include <oldheader.h>\n";
print VRS " * #endif\n";
print VRS "*/ \n\n";
print VRS "#define T2KREWEIGHTRELCODE(a,b,c) (((a) << 16) + ((b) << 8) + (c)) \n\n";
print VRS "#define __T2KREWEIGHT_RELEASE__      \"$release\"\n";
print VRS "#define __T2KREWEIGHT_RELEASE_CODE__ T2KREWEIGHTRELCODE($major,$minor,$revis) \n";
print VRS "\n#endif\n\n";

# Close header file
close(VRS);


